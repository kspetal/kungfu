"use strict";const e=require("../../common/vendor.js"),t=require("../../services/api.js"),o={data:()=>({id:"",recordId:"",form:{name:"",gender:"",birth_date:"",school:"",parent_phone:"",parent_wx:"",address:"",source:0,status:"在学"},recordForm:{project_name:"",card_type:"",start_time:"",end_time:"",course_date:"",deposit:"",total_fee:"",status:1},fold:{profile:!0,project:!0,payment:!0},genderRange:["男","女"],projectRange:["瑜伽","私教课","瑜伽大班","拳击课","普拉提"],sourceRange:["路过看到","早晚知道","朋友介绍","网络活动","其他方式"]}),onLoad(e){e.id&&(this.id=e.id,this.recordId=e.recordId||"",this.loadFromStore())},methods:{formatDate:e=>e?e.split(" ")[0]:"",toggleFold(e){this.fold[e]=!this.fold[e]},onGenderChange(e){const t=Number(e.detail.value);this.form.gender=0===t?"M":"F"},onProjectChange(e){const t=Number(e.detail.value);this.recordForm.project_name=this.projectRange[t]},onSourceChange(e){const t=Number(e.detail.value);this.form.source=t+1},loadFromStore(){const e=getApp(),t=(e&&e.$store&&e.$store.state.students||[]).find((e=>String(e._id)===String(this.id)));if(t){this.form={name:t.name||"",gender:t.gender||"",birth_date:t.birth_date||"",school:t.school||"",parent_phone:t.parent_phone||"",parent_wx:t.parent_wx||"",address:t.address||"",source:t.source||0,status:t.status||"在学"};const e=t.records||[],o=e.find((e=>1===e.status))||e[0]||{};if(this.recordId){const t=e.find((e=>String(e._id)===String(this.recordId)));t&&Object.assign(this.recordForm,{project_name:t.project_name||"",card_type:t.card_type||"",start_time:t.start_time||"",end_time:t.end_time||"",course_date:t.course_date||"",deposit:t.deposit||"",total_fee:t.total_fee||"",status:t.status||1})}else o._id&&Object.assign(this.recordForm,{project_name:o.project_name||"",card_type:o.card_type||"",start_time:o.start_time||"",end_time:o.end_time||"",course_date:o.course_date||"",deposit:o.deposit||"",total_fee:o.total_fee||"",status:o.status||1})}},validate(){return this.form.name?this.recordForm.project_name?this.form.parent_phone?this.recordForm.start_time&&this.recordForm.end_time?this.recordForm.course_date?this.recordForm.total_fee?"":"请输入总费用":"请输入学时时长":"请选择起止日期":"请输入家长电话":"请选择项目":"请输入姓名"},async handleSubmit(){const o=this.validate();if(o)e.index.showToast({title:o,icon:"none"});else try{let o=this.id;if(o)await t.updateStudent(o,this.form);else{const e=await t.createStudent(this.form);o=e._id||e.id}const r={...this.recordForm,student_id:o};this.recordId?await t.updateRecord(this.recordId,r):await t.createRecord(r),e.index.showToast({title:"保存成功",icon:"success"}),setTimeout((()=>{e.index.navigateBack()}),600)}catch(r){console.error("save student error",r),e.index.showToast({title:"保存失败",icon:"none"})}}}};const r=e._export_sfc(o,[["render",function(t,o,r,a,d,s){return e.e({a:e.t(d.fold.profile?"▼":"▲"),b:e.o((e=>s.toggleFold("profile"))),c:d.fold.profile},d.fold.profile?{d:d.form.name,e:e.o((e=>d.form.name=e.detail.value)),f:e.t(d.form.gender?"M"===d.form.gender?"男":"女":"请选择"),g:d.genderRange,h:e.o(((...e)=>s.onGenderChange&&s.onGenderChange(...e))),i:e.t(d.form.birth_date||"请选择日期"),j:e.o((e=>d.form.birth_date=e.detail.value)),k:d.form.school,l:e.o((e=>d.form.school=e.detail.value)),m:d.form.parent_phone,n:e.o((e=>d.form.parent_phone=e.detail.value)),o:d.form.parent_wx,p:e.o((e=>d.form.parent_wx=e.detail.value)),q:d.form.address,r:e.o((e=>d.form.address=e.detail.value))}:{},{s:e.t(d.fold.project?"▼":"▲"),t:e.o((e=>s.toggleFold("project"))),v:d.fold.project},d.fold.project?{w:e.t(d.recordForm.project_name||"请选择项目"),x:d.projectRange,y:e.o(((...e)=>s.onProjectChange&&s.onProjectChange(...e))),z:d.recordForm.card_type,A:e.o((e=>d.recordForm.card_type=e.detail.value)),B:e.t(s.formatDate(d.recordForm.start_time)||"请选择日期"),C:e.o((e=>d.recordForm.start_time=e.detail.value+" 00:00:00")),D:e.t(s.formatDate(d.recordForm.end_time)||"请选择日期"),E:e.o((e=>d.recordForm.end_time=e.detail.value+" 00:00:00")),F:d.recordForm.course_date,G:e.o((e=>d.recordForm.course_date=e.detail.value))}:{},{H:e.t(d.fold.payment?"▼":"▲"),I:e.o((e=>s.toggleFold("payment"))),J:d.fold.payment},d.fold.payment?{K:d.recordForm.deposit,L:e.o((e=>d.recordForm.deposit=e.detail.value)),M:d.recordForm.total_fee,N:e.o((e=>d.recordForm.total_fee=e.detail.value)),O:e.t(d.sourceRange[d.form.source-1]||"请选择"),P:d.sourceRange,Q:e.o(((...e)=>s.onSourceChange&&s.onSourceChange(...e)))}:{},{R:e.o(((...e)=>s.handleSubmit&&s.handleSubmit(...e)))})}],["__scopeId","data-v-d225e7bb"]]);wx.createPage(r);
