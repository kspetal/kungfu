"use strict";const e=require("../../common/vendor.js"),o=require("../../services/api.js"),t={data:()=>({id:"",form:{name:"",gender:"",age:"",school:"",parentPhone:"",parentWechat:"",address:"",project:"",cardType:"",startDate:"",endDate:"",totalLessons:"",remainingLessons:"",tuition:"",deposit:"",totalPaid:"",remark1:"",remark2:"",sourceChannel:0},fold:{profile:!0,project:!0,payment:!0},genderRange:["男","女"],projectRange:["瑜伽","私教课","瑜伽大班","拳击课","普拉提"],sourceRange:["路过看到","早晚知道","朋友介绍","网络活动","其他方式"]}),onLoad(e){e.id&&(this.id=e.id,this.loadFromStore())},methods:{toggleFold(e){this.fold[e]=!this.fold[e]},onGenderChange(e){const o=Number(e.detail.value);this.form.gender=0===o?"M":"F"},onProjectChange(e){const o=Number(e.detail.value);this.form.project=this.projectRange[o]},onSourceChange(e){const o=Number(e.detail.value);this.form.sourceChannel=o+1},loadFromStore(){const e=getApp(),o=(e&&e.$store&&e.$store.state.students||[]).find((e=>String(e.id)===String(this.id)));o&&(this.form={...this.form,...o})},validate(){return this.form.name?this.form.project?this.form.parentPhone?this.form.startDate&&this.form.endDate?this.form.totalLessons&&this.form.remainingLessons?this.form.tuition&&this.form.totalPaid?Number(this.form.totalLessons)<Number(this.form.remainingLessons)?"剩余课时不能大于总课时":"":"请输入金额信息":"请输入课时信息":"请选择起止日期":"请输入家长电话":"请选择项目":"请输入姓名"},async handleSubmit(){const t=this.validate();if(t)e.index.showToast({title:t,icon:"none"});else try{const t={...this.form};this.id?await o.updateStudent(this.id,t):await o.createStudent(t),e.index.showToast({title:"保存成功",icon:"success"}),setTimeout((()=>{e.index.navigateBack()}),600)}catch(r){console.error("save student error",r),e.index.showToast({title:"保存失败",icon:"none"})}}}};const r=e._export_sfc(t,[["render",function(o,t,r,a,n,s){return e.e({a:e.t(n.fold.profile?"▼":"▲"),b:e.o((e=>s.toggleFold("profile"))),c:n.fold.profile},n.fold.profile?{d:n.form.name,e:e.o((e=>n.form.name=e.detail.value)),f:e.t(n.form.gender?"M"===n.form.gender?"男":"女":"请选择"),g:n.genderRange,h:e.o(((...e)=>s.onGenderChange&&s.onGenderChange(...e))),i:n.form.age,j:e.o((e=>n.form.age=e.detail.value)),k:n.form.school,l:e.o((e=>n.form.school=e.detail.value)),m:n.form.parentPhone,n:e.o((e=>n.form.parentPhone=e.detail.value)),o:n.form.parentWechat,p:e.o((e=>n.form.parentWechat=e.detail.value)),q:n.form.address,r:e.o((e=>n.form.address=e.detail.value))}:{},{s:e.t(n.fold.project?"▼":"▲"),t:e.o((e=>s.toggleFold("project"))),v:n.fold.project},n.fold.project?{w:e.t(n.form.project||"请选择项目"),x:n.projectRange,y:e.o(((...e)=>s.onProjectChange&&s.onProjectChange(...e))),z:n.form.cardType,A:e.o((e=>n.form.cardType=e.detail.value)),B:e.t(n.form.startDate||"请选择日期"),C:e.o((e=>n.form.startDate=e.detail.value)),D:e.t(n.form.endDate||"请选择日期"),E:e.o((e=>n.form.endDate=e.detail.value)),F:n.form.totalLessons,G:e.o((e=>n.form.totalLessons=e.detail.value)),H:n.form.remainingLessons,I:e.o((e=>n.form.remainingLessons=e.detail.value))}:{},{J:e.t(n.fold.payment?"▼":"▲"),K:e.o((e=>s.toggleFold("payment"))),L:n.fold.payment},n.fold.payment?{M:n.form.tuition,N:e.o((e=>n.form.tuition=e.detail.value)),O:n.form.deposit,P:e.o((e=>n.form.deposit=e.detail.value)),Q:n.form.totalPaid,R:e.o((e=>n.form.totalPaid=e.detail.value)),S:n.form.remark1,T:e.o((e=>n.form.remark1=e.detail.value)),U:n.form.remark2,V:e.o((e=>n.form.remark2=e.detail.value)),W:e.t(n.sourceRange[n.form.sourceChannel-1]||"请选择"),X:n.sourceRange,Y:e.o(((...e)=>s.onSourceChange&&s.onSourceChange(...e)))}:{},{Z:e.o(((...e)=>s.handleSubmit&&s.handleSubmit(...e)))})}],["__scopeId","data-v-b449febe"]]);wx.createPage(r);
