"use strict";const t=require("../../common/vendor.js"),e=require("../../store/index.js"),s={data:()=>({id:"",student:{},records:[],boyAvatar:"/static/boy.png",girlAvatar:"/static/girl.png"}),onLoad(t){this.id=t.id,this.loadDetail()},methods:{loadDetail(){const{state:t}=e.useGlobalStore(),s=(t&&t.students||[]).find((t=>String(t._id)===String(this.id)));s?this.student=s:this.loadStudent(),this.loadRecords()},async loadStudent(){const e=await t.tr.callFunction({name:"getStudentDetail",data:{id:this.id}});this.students=0===e.result.code?e.result.data:{}},async loadRecords(){const e=await t.tr.callFunction({name:"getRecordList",data:{student_id:this.id}});this.records=0===e.result.code?e.result.data:[]},getActiveRecord(){return this.records&&0!==this.records.length&&(this.records.find((t=>1===t.status))||this.records[0])||null},getTotalDeposit(){return this.records.reduce(((t,e)=>t+(Number(e.deposit)||0)),0)},getTotalFee(){return this.records.reduce(((t,e)=>t+(Number(e.total_fee)||0)),0)},formatDate:t=>t?t.split(" ")[0]:"",getStatusClass:t=>"在学"===t?"status-ongoing":"已退学"===t?"status-completed":"status-ongoing",getRecordStatusText:t=>({0:"已过期",1:"生效中",2:"暂停中"}[t]||"-"),getSourceText:t=>({1:"路过看到",2:"早晚知道",3:"朋友介绍",4:"网络活动",5:"其他方式"}[t]||"-"),goEdit(){var e;t.index.navigateTo({url:`/pages/student-form/index?id=${this.id}&recordId=${(null==(e=this.getActiveRecord())?void 0:e._id)||""}`})},goPayments(){t.index.navigateTo({url:`/pages/student-form/index?id=${this.id}&tab=payments`})},handleDelete(){t.index.showModal({title:"删除确认",content:"确定要删除该学员及其相关记录吗？",success:async e=>{if(e.confirm)try{await deleteStudent(this.id),t.index.showToast({title:"已删除",icon:"success"}),setTimeout((()=>{t.index.navigateBack()}),500)}catch(s){console.error("delete error",s),t.index.showToast({title:"删除失败",icon:"none"})}}})}}};const d=t._export_sfc(s,[["render",function(e,s,d,a,n,o){return{a:n.student.avatar_url||("女"==n.student.gender?n.girlAvatar:n.boyAvatar),b:t.t(n.student.name),c:t.t(n.student.status||"在学"),d:t.n(o.getStatusClass(n.student.status)),e:t.t(n.student.current_project||"-"),f:t.t(n.student.end_time||"-"),g:t.t(o.formatDate(n.student.birth_date)||"-"),h:t.t(n.student.gender),i:t.t(n.student.school||"-"),j:t.t(n.student.parent_phone||"-"),k:t.t(n.student.parent_wx||"-"),l:t.t(n.student.address||"-"),m:t.t(n.student.source||"-"),n:t.f(n.records,((e,s,d)=>({a:t.t(n.records.length>1?`(${s+1})`:""),b:t.t(e.project_name||"-"),c:t.t(e.card_type||"-"),d:t.t(o.getRecordStatusText(e.status)),e:t.t(o.formatDate(e.start_time)),f:t.t(o.formatDate(e.end_time)),g:t.t(e.course_date||0),h:e._id||s}))),o:t.t(n.student.total_studey_date||0),p:t.t(n.student.total_fee||0),q:t.o(((...t)=>o.goPayments&&o.goPayments(...t))),r:t.o(((...t)=>o.goEdit&&o.goEdit(...t))),s:t.o(((...t)=>o.handleDelete&&o.handleDelete(...t)))}}],["__scopeId","data-v-c84e4a42"]]);wx.createPage(d);
