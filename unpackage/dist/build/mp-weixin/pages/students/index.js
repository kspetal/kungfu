"use strict";const e=require("../../common/vendor.js"),t=require("../../services/api.js"),a={data:()=>({keyword:"",project:"",status:"",page:1,pageSize:20,students:[],defaultAvatar:"/static/logo.png",projectFilters:[{label:"所有状态",value:""},{label:"瑜伽",value:"瑜伽"},{label:"私教课",value:"私教课"},{label:"瑜伽大班",value:"瑜伽大班"},{label:"拳击课",value:"拳击课"},{label:"普拉提",value:"普拉提"}]}),onLoad(){this.loadData()},onPullDownRefresh(){this.page=1,this.loadData((()=>{e.index.stopPullDownRefresh()}))},methods:{async loadData(e){try{const a={page:this.page,pageSize:this.pageSize,keyword:this.keyword,project:this.project,status:this.status},s=await t.fetchStudents(a);this.students=s&&s.list||[]}catch(a){console.error("fetch students error",a),this.students=[]}finally{"function"==typeof e&&e()}},handleSearch(){this.page=1,this.loadData()},handleFilterChange(e){this.project=e,this.page=1,this.loadData()},calcProgress(e){const t=e.totalLessons||0,a=e.remainingLessons||0;if(!t)return 0;const s=t-a;return Math.min(100,Math.max(0,s/t*100))},calcProgressColor(e){const t=e.remainingLessons||0,a=e.totalLessons||0;if(!a)return"#4CAF50";const s=t/a;return s<=.2?"#FF4D4F":s<=.5?"#1890FF":"#4CAF50"},goDetail(t){e.index.navigateTo({url:`/pages/student-detail/index?id=${t.id}`})},goCreate(){e.index.navigateTo({url:"/pages/student-form/index"})}}};const s=e._export_sfc(a,[["render",function(t,a,s,o,n,r){return e.e({a:e.o(((...e)=>r.handleSearch&&r.handleSearch(...e))),b:n.keyword,c:e.o((e=>n.keyword=e.detail.value)),d:e.f(n.projectFilters,((t,a,s)=>({a:e.t(t.label),b:t.value,c:n.project===t.value?1:"",d:e.o((e=>r.handleFilterChange(t.value)),t.value)}))),e:0===n.students.length},(n.students.length,{}),{f:e.f(n.students,((t,a,s)=>({a:t.avatarUrl||n.defaultAvatar,b:e.t(t.name),c:e.t(t.project),d:e.t("ongoing"===t.status?"进行中":"已完成"),e:e.n("ongoing"===t.status?"tag-status-ongoing":"tag-status-completed"),f:e.t(t.tuition||0),g:e.t(t.endDate||"-"),h:e.t(t.remainingLessons||0),i:e.t(t.totalLessons||0),j:r.calcProgress(t)+"%",k:r.calcProgressColor(t),l:t.id,m:e.o((e=>r.goDetail(t)),t.id)}))),g:e.o(((...e)=>t.onPullDownRefresh&&t.onPullDownRefresh(...e))),h:e.o(((...e)=>r.goCreate&&r.goCreate(...e)))})}],["__scopeId","data-v-a692ac8d"]]);wx.createPage(s);
